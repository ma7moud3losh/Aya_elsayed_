<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: "Tajawal", sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }
    .order-card {
      background: #fff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px #0001;
    }
    select, button {
      padding: 8px 10px;
      margin: 5px;
      border-radius: 6px;
    }
  </style>
</head>

<body>

  <h2>ğŸ“¦ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>

  <!-- ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© -->
  <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:</label>
  <select id="statusFilter">
    <option value="">Ø§Ù„ÙƒÙ„</option>
    <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>
    <option value="shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
    <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
    <option value="cancelled">Ù…Ù„ØºÙŠ</option>
  </select>
  
  <button onclick="loadOrders()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>

  <h3 id="count"></h3>

  <div id="orders"></div>


<script>
  // Ø§ØªØµØ§Ù„ Supabase
  const supabaseClient = supabase.createClient(
    "https://qccpddjnozehorhleegz.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3BkZGpub3plaG9yaGxlZWd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MTc0NzEsImV4cCI6MjA3OTE5MzQ3MX0.WzG0u9c6wY9eTTh0olIzrPSSPoHhuQhmLTS7zPxXBGA"
  );

  async function loadOrders() {
    const filter = document.getElementById("statusFilter").value;

    let query = supabaseClient
      .from("orders")
      .select(`
        *,
        order_items (
          quantity,
          price,
          products (name)
        )
      `)
      .order("created_at", { ascending: false });

    if (filter) {
      query = query.eq("status", filter); // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    }

    const { data, error } = await query;

    if (error) {
      console.error("Error:", error);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª");
      return;
    }

    displayOrders(data);
  }

  function displayOrders(orders) {
    const container = document.getElementById("orders");
    container.innerHTML = "";

    document.getElementById("count").innerText = `Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${orders.length}`;

    orders.forEach(order => {
      const card = document.createElement("div");
      card.className = "order-card";

      card.innerHTML = `
        <h3>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${order.id}</h3>
        <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${order.customer_name}</p>
        <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${order.phone}</p>
        <p>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${order.address}</p>
        <p>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(order.created_at).toLocaleString()}</p>
        <p>ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${order.status}</strong></p>
        <hr>
        <h4>ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h4>
        ${
          order.order_items.map(item => `
            <p>
              - ${item.products?.name || "Ù…Ù†ØªØ¬ Ù…Ø­Ø°ÙˆÙ"}  
              | Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}  
              | Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬Ù†ÙŠÙ‡
            </p>
          `).join("")
        }
      `;

      container.appendChild(card);
    });
  }

  loadOrders();
</script>

</body>
</html>
