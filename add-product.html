<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ â€” AYA</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Tajawal',sans-serif;background:#FBF7FA;margin:0;color:#333}
.header{background:white;padding:12px 18px;box-shadow:0 2px 10px rgba(0,0,0,0.05);display:flex;justify-content:space-between;align-items:center}
.logo{color:#FF4F9D;font-weight:700}
.container{max-width:820px;margin:28px auto;padding:16px}
.form{
  background:white;border-radius:16px;padding:18px;box-shadow:0 15px 30px rgba(0,0,0,0.04);display:grid;grid-template-columns:1fr 320px;gap:18px;
}
.form-left{display:flex;flex-direction:column;gap:12px}
label{font-weight:600;color:#333}
input, textarea{
  width:100%;padding:10px;border-radius:10px;border:1px solid #eee;font-size:15px
}
textarea{min-height:120px;resize:vertical}
.image-drop{
  border-radius:12px;border:2px dashed #F2E6EE;padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;height:250px;background:white;cursor:pointer;
}
.preview{width:100%;height:100%;object-fit:cover;border-radius:10px;display:none;}
.btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-save{background:#FF4F9D;color:white}
.btn-clear{background:transparent;border:1px solid #eee}
.product-list{margin-top:35px;background:white;padding:18px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.04)}
.product-item{
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid #eee;padding:10px 0
}
.product-item:last-child{border-bottom:none}
.delete-btn{
  background:#ff3b3b;color:white;padding:7px 14px;border-radius:8px;border:none;cursor:pointer;
}
</style>
</head>

<body>

<header class="header">
  <div style="display:flex;align-items:center;gap:8px">
    <div class="logo">AYA BEAUTY</div>
    <div style="color:#999;font-size:14px">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
  </div>
</header>

<main class="container">

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
  <div class="form">

    <div class="form-left">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input id="name" type="text">

      <label>Ø§Ù„Ø³Ø¹Ø± (Ø¬Ù†ÙŠÙ‡)</label>
      <input id="price" type="number">

      <label>Ø§Ù„ÙˆØµÙ</label>
      <textarea id="description"></textarea>

      <div>
        <button class="btn btn-save" onclick="addProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
      </div>
    </div>

    <div>
      <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>

      <div class="image-drop" id="dropzone" onclick="document.getElementById('file').click()">
        <div id="drop-content" style="text-align:center;color:#777">
          <div style="font-size:42px">ğŸ“·</div>
          <div style="font-weight:600">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§</div>
        </div>
        <img id="preview" class="preview">
      </div>

      <input id="file" type="file" accept="image/*" style="display:none" onchange="handleFile(event)">
    </div>

  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <div class="product-list" id="productList">
    <h3 style="margin-bottom:12px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
    <div id="products"></div>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Supabase
const supabaseUrl = "https://qccpddjnozehorhleegz.supabase.co";
const supabaseKey = "sb_publishable_rSdFTm7TUh-HDRLKacdZxw_BpQOTeIr";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

let selectedFile = null;

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø©
function handleFile(e){
  const file=e.target.files[0];
  if(!file)return;
  selectedFile=file;
  document.getElementById("preview").src=URL.createObjectURL(file);
  document.getElementById("preview").style.display="block";
  document.getElementById("drop-content").style.display="none";
}

// Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
async function addProduct(){
  const name=document.getElementById("name").value.trim();
  const price=document.getElementById("price").value.trim();
  const description=document.getElementById("description").value.trim();

  if(!name||!price||!selectedFile){
    alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");
    return;
  }

  const fileName=Date.now()+"_"+selectedFile.name.replace(/\s+/g,"_");

  // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
  const {error:uploadErr}=await supabase
    .storage
    .from("products")
    .upload(fileName,selectedFile);

  if(uploadErr){
    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
    return;
  }

  // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
  const imageUrl=supabase
    .storage
    .from("products")
    .getPublicUrl(fileName).data.publicUrl;

  // Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  await supabase
    .from("products")
    .insert({name,price,description,image:imageUrl});

  alert("âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬");

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  loadProducts();
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function loadProducts(){
  const productsBox=document.getElementById("products");
  productsBox.innerHTML="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const {data,error}=await supabase
    .from("products")
    .select("*")
    .order("created_at",{ascending:false});
  
  if(error){
    productsBox.innerHTML="Ø­Ø¯Ø« Ø®Ø·Ø£";
    return;
  }

  productsBox.innerHTML = data.map(p=>`
    <div class="product-item">
      <div>${p.name} â€” ${p.price} Ø¬Ù†ÙŠÙ‡</div>
      <button class="delete-btn" onclick="deleteProduct('${p.id}','${p.image}')">ğŸ—‘ Ø­Ø°Ù</button>
    </div>
  `).join("");
}

// Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
async function deleteProduct(id, imageUrl) {
  if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©
  const path = imageUrl.split("/storage/v1/object/public/products/")[1];

  if (path) {
    await supabase.storage.from("products").remove([path]);
  }

  await supabase.from("products").delete().eq("id", id);

  alert("âœ” ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬");

  loadProducts();
}

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„
loadProducts();

</script>

</body>
</html>
